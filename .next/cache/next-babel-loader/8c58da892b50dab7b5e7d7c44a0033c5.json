{"ast":null,"code":"var _jsxFileName = \"C:\\\\test\\\\component\\\\editusermessage\\\\show\\\\avatarLoadPhoto.js\";\nimport _JSXStyle from \"styled-jsx/style\";\nvar __jsx = React.createElement;\nimport React from 'react';\n\nfunction Loadphoto({\n  data\n}) {\n  const uploadBu = e => {\n    //上传图片按钮事件\n    e.target.nextElementSibling.click();\n  };\n\n  const fileChange = e => {\n    //上传图片文件解析事件\n    let img = document.createElement('img');\n    img.src = URL.createObjectURL(e.target.files[0]);\n    e.target.value = '';\n\n    img.onload = () => {\n      document.querySelector('.photo-container').append(img);\n      canvasFunc(img.offsetWidth, img.offsetHeight, img);\n    };\n  };\n\n  return __jsx(React.Fragment, null, __jsx(\"button\", {\n    onClick: uploadBu,\n    className: \"jsx-369983592\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 21\n    },\n    __self: this\n  }, \"\\u66F4\\u6362\\u5934\\u50CF\"), __jsx(\"input\", {\n    type: \"file\",\n    name: \"avatar-photo\",\n    id: \"photo\",\n    onChange: fileChange,\n    hidden: true,\n    className: \"jsx-369983592\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 24\n    },\n    __self: this\n  }), __jsx(\"div\", {\n    style: {\n      position: 'fixed',\n      left: 0,\n      top: 0,\n      visibility: 'hidden',\n      userSelect: 'none'\n    },\n    className: \"jsx-369983592\" + \" \" + \"photo-container\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 29\n    },\n    __self: this\n  }), __jsx(\"canvas\", {\n    id: \"canvas\",\n    hidden: true,\n    className: \"jsx-369983592\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 36\n    },\n    __self: this\n  }), __jsx(\"canvas\", {\n    id: \"canvas2\",\n    hidden: true,\n    className: \"jsx-369983592\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 39\n    },\n    __self: this\n  }), __jsx(_JSXStyle, {\n    id: \"369983592\",\n    __self: this\n  }, \"button.jsx-369983592{background:none;border:none;outline:none;color:#3897f0;font-weight:700;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFx0ZXN0XFxjb21wb25lbnRcXGVkaXR1c2VybWVzc2FnZVxcc2hvd1xcYXZhdGFyTG9hZFBob3RvLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQXlDMkIsQUFHNEMsZ0JBQ0osWUFDQyxhQUNDLGNBQ0UsZ0JBQ25CIiwiZmlsZSI6IkM6XFx0ZXN0XFxjb21wb25lbnRcXGVkaXR1c2VybWVzc2FnZVxcc2hvd1xcYXZhdGFyTG9hZFBob3RvLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0J1xyXG5cclxuZnVuY3Rpb24gTG9hZHBob3RvKHtkYXRhfSkge1xyXG4gICAgY29uc3QgdXBsb2FkQnUgPSAoZSkgPT4geyAgICAgIC8v5LiK5Lyg5Zu+54mH5oyJ6ZKu5LqL5Lu2XHJcbiAgICAgICAgZS50YXJnZXQubmV4dEVsZW1lbnRTaWJsaW5nLmNsaWNrKCk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZmlsZUNoYW5nZSA9IChlKSA9PiB7ICAgICAvL+S4iuS8oOWbvueJh+aWh+S7tuino+aekOS6i+S7tlxyXG4gICAgICAgXHJcbiAgICAgICBsZXQgaW1nICA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xyXG4gICAgICAgaW1nLnNyYyA9IFVSTC5jcmVhdGVPYmplY3RVUkwoZS50YXJnZXQuZmlsZXNbMF0pO1xyXG4gICAgICAgZS50YXJnZXQudmFsdWUgPSAnJzsgXHJcbiAgICAgICBpbWcub25sb2FkID0gKCkgPT4geyAgIFxyXG4gICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5waG90by1jb250YWluZXInKS5hcHBlbmQoaW1nKTtcclxuICAgICAgICAgICBjYW52YXNGdW5jKGltZy5vZmZzZXRXaWR0aCxpbWcub2Zmc2V0SGVpZ2h0LGltZyk7XHJcbiAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gKFxyXG4gICAgICAgIDw+XHJcbiAgICAgICAgICAgICAgICA8YnV0dG9uIG9uQ2xpY2s9e3VwbG9hZEJ1fT5cclxuICAgICAgICAgICAgICAgICAgICAgICAg5pu05o2i5aS05YOPXHJcbiAgICAgICAgICAgICAgICA8L2J1dHRvbj5cclxuICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPVwiZmlsZVwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU9XCJhdmF0YXItcGhvdG9cIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZD1cInBob3RvXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9e2ZpbGVDaGFuZ2V9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhpZGRlbi8+XHJcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cInBob3RvLWNvbnRhaW5lclwiIHN0eWxlPXt7cG9zaXRpb246J2ZpeGVkJyxcclxuICAgICAgICAgICAgICAgIGxlZnQ6MCx0b3A6MCxcclxuICAgICAgICAgICAgICAgIHZpc2liaWxpdHk6J2hpZGRlbicsXHJcbiAgICAgICAgICAgICAgICB1c2VyU2VsZWN0Oidub25lJyAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIH19PlxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgIDxjYW52YXMgaWQ9XCJjYW52YXNcIiBoaWRkZW4+XHJcbiAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgPC9jYW52YXM+XHJcbiAgICAgICAgICAgICAgICA8Y2FudmFzIGlkPVwiY2FudmFzMlwiIGhpZGRlbiA+XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICA8L2NhbnZhcz5cclxuICAgICAgICAgICAgICA8c3R5bGUganN4PiB7YFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBidXR0b24geyAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZDpub25lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9yZGVyOm5vbmU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRsaW5lOm5vbmU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjojMzg5N2YwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9udC13ZWlnaHQ6NzAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGB9XHJcbiAgICAgICAgICAgICAgPC9zdHlsZT4gICAgICAgICAgICAgICBcclxuICAgICAgICA8Lz5cclxuICAgIClcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgTG9hZHBob3RvXHJcblxyXG5cclxuY29uc3QgY2FudmFzRnVuYyA9IChXLEgsaW1nKSA9PiB7XHJcbiAgICBcclxuICAgICAgICBsZXQgY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbnZhcycpO1xyXG4gICAgICAgIGxldCAgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XHJcbiAgICAgICAgbGV0IGNvdW50ID0gTWF0aC5taW4oVyxIKTtcclxuICAgICAgICBjYW52YXMud2lkdGggPSBjb3VudDtcclxuICAgICAgICBjYW52YXMuaGVpZ2h0ID0gY291bnQ7XHJcbiAgICAgICAgbGV0IHcgPShNYXRoLm1heChXLEgpLWNvdW50KS8yOyAgICBcclxuICAgICAgICBXPkg/Y3R4LmRyYXdJbWFnZShpbWcsLXcsMCk6IGN0eC5kcmF3SW1hZ2UoaW1nLDAsLXcpOyAvL+ijgeWHj+aIkOS4gOavlOS4gFxyXG4gICAgICAgIFxyXG5cclxuICAgICAgICBsZXQgY3R4MiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW52YXMyJykuZ2V0Q29udGV4dCgnMmQnKTtcclxuICAgICAgICBjYW52YXMyLndpZHRoID0gNDA7XHJcbiAgICAgICAgY2FudmFzMi5oZWlnaHQ9IDQwO1xyXG4gICAgICAgIGN0eDIuZHJhd0ltYWdlKGNhbnZhcywwLDAsNDAsNDApOyAgLy8g57yp5pS+5oiQNDBweCA0MHB4XHJcbiAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FudmFzMicpLnRvQmxvYigoYmxvYikgPT4geyAgLy8g6L6T5Ye65Zu+54mHXHJcbiAgICAgICAgbGV0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XHJcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKFwiZmlsZVwiLGJsb2IsIFwiaW1hZ2UucG5nXCIpO1xyXG4gICAgICAgIGZldGNoKCdodHRwOi8vbG9jYWxob3N0OjMwMDEvZ2V0cGhvdG9zLy9hdmF0YXInLFxyXG4gICAgICAgIHttZXRob2Q6J1BPU1QnLGJvZHk6Zm9ybURhdGEsY3JlZGVudGlhbHM6IFwiaW5jbHVkZVwifSlcclxuICAgICAgICAudGhlbihyZXMgPT4gcmVzLmpzb24oKSlcclxuICAgICAgICAudGhlbihyZXN1bHQgPT4gaW1nKTtcclxuICAgICAgICAvLyBsZXQgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcclxuICAgICAgICAvLyBsaW5rLmRvd25sb2FkID0gJ2xpa2UuanBnJztcclxuICAgICAgICAvLyBsaW5rLmhyZWYgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xyXG4gICAgICAgIC8vIGxpbmsuY2xpY2soKTtcclxuICAgICAgICAvLyBVUkwucmV2b2tlT2JqZWN0VVJMKGxpbmsuaHJlZik7ICAvL+WIoOmZpGJsb2Ig5YaF5a2Y57yT5a2YXHJcbiAgICB9LCdpbWFnZS9wbmcnKVxyXG4gICAgXHJcbn0iXX0= */\\n/*@ sourceURL=C:\\\\\\\\test\\\\\\\\component\\\\\\\\editusermessage\\\\\\\\show\\\\\\\\avatarLoadPhoto.js */\"));\n}\n\nexport default Loadphoto;\n\nconst canvasFunc = (W, H, img) => {\n  let canvas = document.getElementById('canvas');\n  let ctx = canvas.getContext('2d');\n  let count = Math.min(W, H);\n  canvas.width = count;\n  canvas.height = count;\n  let w = (Math.max(W, H) - count) / 2;\n  W > H ? ctx.drawImage(img, -w, 0) : ctx.drawImage(img, 0, -w); //裁减成一比一\n\n  let ctx2 = document.getElementById('canvas2').getContext('2d');\n  canvas2.width = 40;\n  canvas2.height = 40;\n  ctx2.drawImage(canvas, 0, 0, 40, 40); // 缩放成40px 40px\n\n  document.getElementById('canvas2').toBlob(blob => {\n    // 输出图片\n    let formData = new FormData();\n    formData.append(\"file\", blob, \"image.png\");\n    fetch('http://localhost:3001/getphotos//avatar', {\n      method: 'POST',\n      body: formData,\n      credentials: \"include\"\n    }).then(res => res.json()).then(result => img); // let link = document.createElement('a');\n    // link.download = 'like.jpg';\n    // link.href = URL.createObjectURL(blob);\n    // link.click();\n    // URL.revokeObjectURL(link.href);  //删除blob 内存缓存\n  }, 'image/png');\n};","map":{"version":3,"sources":["C:/test/component/editusermessage/show/avatarLoadPhoto.js"],"names":["React","Loadphoto","data","uploadBu","e","target","nextElementSibling","click","fileChange","img","document","createElement","src","URL","createObjectURL","files","value","onload","querySelector","append","canvasFunc","offsetWidth","offsetHeight","position","left","top","visibility","userSelect","W","H","canvas","getElementById","ctx","getContext","count","Math","min","width","height","w","max","drawImage","ctx2","canvas2","toBlob","blob","formData","FormData","fetch","method","body","credentials","then","res","json","result"],"mappings":"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","sourcesContent":["import React from 'react'\r\n\r\nfunction Loadphoto({data}) {\r\n    const uploadBu = (e) => {      //上传图片按钮事件\r\n        e.target.nextElementSibling.click();\r\n    }\r\n\r\n    const fileChange = (e) => {     //上传图片文件解析事件\r\n       \r\n       let img  = document.createElement('img');\r\n       img.src = URL.createObjectURL(e.target.files[0]);\r\n       e.target.value = ''; \r\n       img.onload = () => {   \r\n                 \r\n           document.querySelector('.photo-container').append(img);\r\n           canvasFunc(img.offsetWidth,img.offsetHeight,img);\r\n       }\r\n    }\r\n    return (\r\n        <>\r\n                <button onClick={uploadBu}>\r\n                        更换头像\r\n                </button>\r\n                <input type=\"file\"\r\n                        name=\"avatar-photo\"\r\n                        id=\"photo\"\r\n                        onChange={fileChange}\r\n                        hidden/>\r\n                <div className=\"photo-container\" style={{position:'fixed',\r\n                left:0,top:0,\r\n                visibility:'hidden',\r\n                userSelect:'none'                \r\n                }}>\r\n                \r\n                </div>\r\n                <canvas id=\"canvas\" hidden>\r\n                     \r\n                </canvas>\r\n                <canvas id=\"canvas2\" hidden >\r\n                    \r\n                </canvas>\r\n              <style jsx> {`\r\n                        button {                        \r\n                            background:none;\r\n                            border:none;\r\n                            outline:none;\r\n                            color:#3897f0;\r\n                            font-weight:700;\r\n                        }\r\n                        `}\r\n              </style>               \r\n        </>\r\n    )\r\n}\r\n\r\nexport default Loadphoto\r\n\r\n\r\nconst canvasFunc = (W,H,img) => {\r\n    \r\n        let canvas = document.getElementById('canvas');\r\n        let  ctx = canvas.getContext('2d');\r\n        let count = Math.min(W,H);\r\n        canvas.width = count;\r\n        canvas.height = count;\r\n        let w =(Math.max(W,H)-count)/2;    \r\n        W>H?ctx.drawImage(img,-w,0): ctx.drawImage(img,0,-w); //裁减成一比一\r\n        \r\n\r\n        let ctx2 = document.getElementById('canvas2').getContext('2d');\r\n        canvas2.width = 40;\r\n        canvas2.height= 40;\r\n        ctx2.drawImage(canvas,0,0,40,40);  // 缩放成40px 40px\r\n       document.getElementById('canvas2').toBlob((blob) => {  // 输出图片\r\n        let formData = new FormData();\r\n        formData.append(\"file\",blob, \"image.png\");\r\n        fetch('http://localhost:3001/getphotos//avatar',\r\n        {method:'POST',body:formData,credentials: \"include\"})\r\n        .then(res => res.json())\r\n        .then(result => img);\r\n        // let link = document.createElement('a');\r\n        // link.download = 'like.jpg';\r\n        // link.href = URL.createObjectURL(blob);\r\n        // link.click();\r\n        // URL.revokeObjectURL(link.href);  //删除blob 内存缓存\r\n    },'image/png')\r\n    \r\n}"]},"metadata":{},"sourceType":"module"}