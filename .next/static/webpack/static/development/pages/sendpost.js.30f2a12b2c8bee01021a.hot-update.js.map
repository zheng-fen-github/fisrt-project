{"version":3,"file":"static/webpack/static\\development\\pages\\sendpost.js.30f2a12b2c8bee01021a.hot-update.js","sources":["webpack:///./component/home/addcontent/addPhoto/addphoto.js"],"sourcesContent":["import React,{useState} from 'react'\r\nimport Top from './addPhototop'\r\nimport Content from './addphotolist'\r\nimport Form from './postform/form'\r\nimport AddBu from './addbu'\r\nimport {useRouter} from 'next/router'\r\nimport Loading from '../../../public/loading'\r\n\r\nfunction AddPhoto() {\r\n    const data = useRouter();\r\n    const [PhotoFiles, setPhotoFiles] = useState([]);\r\n    const [fetching,setFetching] = useState(false);\r\n    const fileRef = React.createRef(); // file Dom 定义\r\n    let canvasRef; \r\n\r\n    const fileClick = () => {      // 添加图片FileDOM 点击事件\r\n        fileRef.current.click(); \r\n    } \r\n    const uploadPhoto =async (e) => {\r\n        e.preventDefault();\r\n        if(PhotoFiles.length<1) {           // 检测是否有照片添加\r\n            let reming = document.querySelector('.remind');            \r\n            reming.hidden = false;\r\n            setTimeout(() => reming.hidden = true,2000);\r\n            return\r\n        }          \r\n            // 添加信息和照片到服务器\r\n        const formData = new FormData(e.target);\r\n        formData.delete('photoFile');\r\n        let filesPromises = PhotoFiles.map( async (photo) => {            \r\n                    let img = new Image();                             //裁减图片1比1。\r\n                    img.src = URL.createObjectURL(photo.file);\r\n                    let promise = new Promise((resolve) => {\r\n                        img.onload = () =>{\r\n                            let {width,height}  = img;                         \r\n                            let size = width>height?height:width;\r\n                            let count = width>height?width-size:height-size;\r\n                            let countAr = width>height?[-count/2,0]:[0,-count/2];\r\n                            canvasRef.width = size;\r\n                            canvasRef.height = size;                                                \r\n                            canvasRef.getContext('2d').drawImage(img,...countAr);\r\n                            canvasRef.toBlob(blob => { \r\n                             resolve(blob)\r\n                            })\r\n                        }  \r\n                    })\r\n                    let blob;\r\n                    await promise.then(result => blob = result);\r\n                    let file = new File([blob],photo.file.name,{\r\n                        type:photo.file.type,\r\n                    })\r\n                    return file;            \r\n        });\r\n        let files;\r\n        await Promise.all(filesPromises).then( file => files =file);\r\n       \r\n        files.forEach(file =>{\r\n            formData.append('photoFile',file)\r\n        });\r\n        \r\n        \r\n        // if(!data.account) return alert('未获取作者 程序错误');\r\n        formData.append('name',name.textContent);\r\n        \r\n      \r\n        (async () => {\r\n            // setFetching(true);\r\n            let require = await fetch('http://localhost:3001/getphoto/post',\r\n                        {method:'POST',body:formData});\r\n            let res = await require.json();\r\n            if(res)console.log(res)\r\n        })() \r\n                 \r\n    }\r\n    return (\r\n        <div className='add-photo'>\r\n          {!fetching?<>\r\n                    <div className=\"container\">\r\n                    <Top/>\r\n                    <form onSubmit={uploadPhoto}>\r\n                            <Content click={fileClick}\r\n                                setPhotoFiles={setPhotoFiles}\r\n                                PhotoFiles={PhotoFiles}/>\r\n\r\n                            {PhotoFiles.length>0 && <AddBu click={fileClick}/>}\r\n\r\n                            <Form ref={fileRef} setFile={setPhotoFiles}> \r\n                                <div className=\"remind\" onClick={(e) =>e.target.hidden = true } hidden>\r\n                                        请添加至少一张照片\r\n                                </div>\r\n                            </Form>\r\n                    </form>\r\n                    </div>\r\n                    <canvas ref={ref => canvasRef = ref} hidden style={{position:'fixed',left:0,top:0,zIndex:99}}>\r\n                        \r\n                    </canvas>\r\n                 </>:<Loading/>}\r\n            \r\n            <style jsx> {`\r\n                            .add-photo {\r\n                                position:fixed;\r\n                                top:0;\r\n                                left:0;\r\n                                height:100vh;\r\n                                width:100vw;\r\n                                background:#f4f7f9;\r\n                                z-index:10;\r\n                            }\r\n                            .user{\r\n                                position:fixed;\r\n                                top:50%;\r\n                                left:40px;\r\n                                transform:translate(0,-50%);                                                                                                \r\n                            }\r\n                            .container::-webkit-scrollbar {\r\n                                display:none;\r\n                            }\r\n                            .container {\r\n                                height:100%;\r\n                                width:980px;\r\n                                margin:0 auto;\r\n                                background:white;\r\n                                box-shadow:0 0 4px #eee;\r\n                                overflow:auto;\r\n                                padding-bottom:40vh;\r\n                            }\r\n                            .remind {\r\n                                width:90%;\r\n                                height:50px;\r\n                                border-radius:12px;\r\n                                color:white;\r\n                                text-align:center;\r\n                                line-height:50px;\r\n                                font-size:20px;\r\n                                background:red;\r\n                                animation: go .2s;\r\n                            }\r\n                            @keyframes go {\r\n                                0% {\r\n                                    transform:scale(0.8);\r\n                                }\r\n                                100% {\r\n                                    transform:scale(1);\r\n                                }\r\n                            }\r\n                            `}\r\n            </style>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default AddPhoto\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AAGA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAFA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AALA;AACA;AADA;AAQA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AADA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAhBA;AAAA;AAkBA;AAAA;AACA;AAnBA;AAmBA;AACA;AADA;AAnBA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAXA;AAAA;AAoCA;AAAA;AACA;AArCA;AAsCA;AACA;AACA;AACA;AAGA;AACA;AAEA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AACA;AAJA;AAEA;AAFA;AAAA;AACA;AADA;AAIA;AACA;AACA;AANA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAhDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAuDA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AArBA;AAAA;AAAA;AA0EA;AACA;AACA;;;;A","sourceRoot":""}