{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _JSXStyle from \"styled-jsx/style\";\nvar __jsx = React.createElement;\nimport React, { useState, useEffect } from 'react';\nimport CommentList from './features-comment';\nimport Router from 'next/router';\nimport Login from './feacturesbutton';\nimport Url from '../../../../../url';\n\nfunction Features(_ref) {\n  var id = _ref.id,\n      comment = _ref.comment,\n      message = _ref.message;\n  var formRef = React.createRef();\n  var buAllRef;\n\n  var _useState = useState(false),\n      status = _useState[0],\n      setStatus = _useState[1];\n\n  useEffect(function () {\n    //判断帖子中是否收藏 点赞过       \n    if (message) {\n      var result = message.message.like.findIndex(function (e) {\n        return e.postId == id;\n      });\n\n      if (result != -1) {\n        buAllRef.children[0].children[0].classList.add('icon-dianzan1');\n      }\n\n      var result2 = message.message.save.findIndex(function (e) {\n        return e.postId == id;\n      });\n\n      if (result2 != -1) {\n        buAllRef.children[1].children[0].classList.add('icon-shoucang1');\n      }\n    }\n  }, []);\n\n  var commentEv = function commentEv() {\n    //打开评论界面按钮事件\n    if (!message) return alert('请先登录');\n    var form = formRef.current;\n\n    if (getComputedStyle(form).display == 'none') {\n      form.style.display = 'flex';\n      if (!form.hidden) form.children[0].focus();\n    } else {\n      form.style.display = 'none';\n    }\n  };\n\n  var saveEv = function saveEv(e) {\n    var target, request, res, _request, _res;\n\n    return _regeneratorRuntime.async(function saveEv$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (message) {\n              _context.next = 2;\n              break;\n            }\n\n            return _context.abrupt(\"return\", alert('请先登录'));\n\n          case 2:\n            target = e.target.closest('.save').children[0]; //定义save按钮元素\n\n            target.classList.toggle('icon-shoucang1');\n\n            if (!target.classList.contains('icon-shoucang1')) {\n              _context.next = 17;\n              break;\n            }\n\n            _context.next = 7;\n            return _regeneratorRuntime.awrap(fetch(\"\".concat(Url, \"post/save/\").concat(id), {\n              method: 'POST',\n              credentials: \"include\"\n            }));\n\n          case 7:\n            request = _context.sent;\n\n            if (request.status === 404) {\n              setStatus(true);\n              target.classList.remove('icon-shoucang1');\n            }\n\n            ;\n            if (request.status === 500) target.classList.remove('icon-shoucang1');\n            _context.next = 13;\n            return _regeneratorRuntime.awrap(request.json());\n\n          case 13:\n            res = _context.sent;\n            console.log(res);\n            _context.next = 26;\n            break;\n\n          case 17:\n            _context.next = 19;\n            return _regeneratorRuntime.awrap(fetch(\"\".concat(Url, \"post/save/remove/\").concat(id), {\n              method: 'POST',\n              credentials: \"include\"\n            }));\n\n          case 19:\n            _request = _context.sent;\n\n            if (_request.status === 404) {\n              setStatus(true);\n              target.classList.remove('icon-shoucang1');\n            }\n\n            ;\n            _context.next = 24;\n            return _regeneratorRuntime.awrap(_request.json());\n\n          case 24:\n            _res = _context.sent;\n            console.log(_res);\n\n          case 26:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var likeEv = function likeEv(e) {\n    var target, request, res, _request2, _res2;\n\n    return _regeneratorRuntime.async(function likeEv$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            if (message) {\n              _context2.next = 2;\n              break;\n            }\n\n            return _context2.abrupt(\"return\", alert('请先登录'));\n\n          case 2:\n            target = e.target.closest('.like').children[0]; //定义like按钮元素\n\n            target.classList.toggle('icon-dianzan1');\n\n            if (!target.classList.contains('icon-dianzan1')) {\n              _context2.next = 18;\n              break;\n            }\n\n            _context2.next = 7;\n            return _regeneratorRuntime.awrap(fetch(\"\".concat(Url, \"post/like/\").concat(id), {\n              method: 'POST',\n              credentials: \"include\"\n            }));\n\n          case 7:\n            request = _context2.sent;\n\n            if (request.status == 404) {\n              setStatus(true);\n              target.classList.remove('icon-dianzan1');\n            }\n\n            ;\n            ;\n            if (request.status == 303) target.classList.remove('icon-dianzan1');\n            _context2.next = 14;\n            return _regeneratorRuntime.awrap(request.json());\n\n          case 14:\n            res = _context2.sent;\n            console.log(res);\n            _context2.next = 28;\n            break;\n\n          case 18:\n            _context2.next = 20;\n            return _regeneratorRuntime.awrap(fetch(\"\".concat(Url, \"post/like/remove/\").concat(id), {\n              method: 'POST',\n              credentials: \"include\"\n            }));\n\n          case 20:\n            _request2 = _context2.sent;\n\n            if (_request2.status == 404) {\n              setStatus(true);\n              target.classList.remove('icon-dianzan1');\n            }\n\n            ;\n            ;\n            _context2.next = 26;\n            return _regeneratorRuntime.awrap(_request2.json());\n\n          case 26:\n            _res2 = _context2.sent;\n            console.log(_res2);\n\n          case 28:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var linkRef; // 复制事件 DOM 定义和事件。\n\n  var share = function share() {\n    var range = new Range();\n    range.setStart(linkRef, 0);\n    range.setEnd(linkRef, 2);\n    document.getSelection().removeAllRanges();\n    document.getSelection().addRange(range);\n    document.execCommand(\"Copy\");\n    alert('复制成功');\n  };\n\n  return __jsx(\"div\", {\n    className: \"jsx-3803869540\" + \" \" + \"features\"\n  }, __jsx(CommentList, {\n    ref: formRef,\n    id: id,\n    message: message,\n    comment: comment\n  }), __jsx(\"div\", {\n    ref: function ref(_ref3) {\n      return buAllRef = _ref3;\n    },\n    className: \"jsx-3803869540\" + \" \" + \"button-All\"\n  }, __jsx(\"div\", {\n    onClick: likeEv,\n    className: \"jsx-3803869540\" + \" \" + \"like\"\n  }, __jsx(\"i\", {\n    className: \"jsx-3803869540\" + \" \" + 'iconfont icon-dianzan'\n  }), __jsx(\"h4\", {\n    className: \"jsx-3803869540\"\n  }, \"Like\")), __jsx(\"div\", {\n    onClick: saveEv,\n    className: \"jsx-3803869540\" + \" \" + \"save\"\n  }, __jsx(\"i\", {\n    className: \"jsx-3803869540\" + \" \" + 'iconfont icon-shoucang'\n  }), __jsx(\"h4\", {\n    className: \"jsx-3803869540\"\n  }, \"save\")), __jsx(\"div\", {\n    onClick: commentEv,\n    className: \"jsx-3803869540\" + \" \" + \"comment\"\n  }, __jsx(\"i\", {\n    className: \"jsx-3803869540\" + \" \" + 'iconfont icon-pinglun'\n  }), __jsx(\"h4\", {\n    className: \"jsx-3803869540\"\n  }, \"comment\")), __jsx(\"div\", {\n    onClick: share,\n    className: \"jsx-3803869540\" + \" \" + \"share\"\n  }, __jsx(\"i\", {\n    className: \"jsx-3803869540\" + \" \" + 'iconfont icon-fenxiang'\n  }), __jsx(\"h4\", {\n    className: \"jsx-3803869540\"\n  }, \"share\")), __jsx(\"div\", {\n    style: {\n      opacity: 0\n    },\n    className: \"jsx-3803869540\" + \" \" + \"link\"\n  }, __jsx(\"h3\", {\n    ref: function ref(_ref2) {\n      return linkRef = _ref2;\n    },\n    className: \"jsx-3803869540\"\n  }, Url, \"post?id=\", id))), status && __jsx(Login, {\n    ev: setStatus\n  }), __jsx(_JSXStyle, {\n    id: \"3803869540\"\n  }, [\"i.jsx-3803869540{font-size:30px;margin-right:6px;}\", \".icon-dianzan1.jsx-3803869540{color:#E84F43;-webkit-animation:click-jsx-3803869540 0.5s 1;animation:click-jsx-3803869540 0.5s 1;}\", \".icon-shoucang1.jsx-3803869540{color:#FFF710;-webkit-animation:click-jsx-3803869540 0.5s 1;animation:click-jsx-3803869540 0.5s 1;}\", \".features.jsx-3803869540{background:white;}\", \".link.jsx-3803869540{position:fixed;top:-200px;}\", \"@-webkit-keyframes click-jsx-3803869540{0%{-webkit-transform:scale(0);-ms-transform:scale(0);transform:scale(0);}100%{-webkit-transform:scale(1);-ms-transform:scale(1);transform:scale(1);}}\", \"@keyframes click-jsx-3803869540{0%{-webkit-transform:scale(0);-ms-transform:scale(0);transform:scale(0);}100%{-webkit-transform:scale(1);-ms-transform:scale(1);transform:scale(1);}}\", \".button-All.jsx-3803869540{width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:8vh;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}\", \".button-All.jsx-3803869540>div.jsx-3803869540{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:1;-ms-flex:1;flex:1;height:6vh;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-right:4vh;opacity:0.5;}\", \".button-All.jsx-3803869540>div.jsx-3803869540:hover{opacity:1;}\", \".like.jsx-3803869540{margin-left:4vh;}\", \"@media (max-width:800px){i.jsx-3803869540{font-size:32px;}.like.jsx-3803869540{margin-left:0;}.button-All.jsx-3803869540>div.jsx-3803869540{margin-right:0;}h4.jsx-3803869540{display:none;}}\"]));\n}\n\nexport default Features;","map":null,"metadata":{},"sourceType":"module"}