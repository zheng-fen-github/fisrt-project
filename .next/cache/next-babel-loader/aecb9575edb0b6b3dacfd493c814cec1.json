{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _JSXStyle from \"styled-jsx/style\";\nvar __jsx = React.createElement;\nimport React, { useEffect } from 'react';\nimport CommentList from './features-comment';\nimport Router from 'next/router';\n\nfunction Features(_ref) {\n  var id = _ref.id,\n      comment = _ref.comment,\n      message = _ref.message;\n  var formRef = React.createRef();\n  var buAllRef;\n  useEffect(function () {\n    //判断帖子中是否收藏 点赞过\n    if (message) {\n      var result = message.like.findIndex(function (e) {\n        return e.postId == id;\n      });\n\n      if (result != -1) {\n        buAllRef.children[0].children[0].classList.add('icon-dianzan1');\n      }\n\n      var result2 = message.save.findIndex(function (e) {\n        return e.postId == id;\n      });\n\n      if (result2 != -1) {\n        buAllRef.children[1].children[0].classList.add('icon-shoucang1');\n      }\n    }\n  }, []);\n\n  var commentEv = function commentEv() {\n    //打开评论界面按钮事件\n    var form = formRef.current;\n\n    if (getComputedStyle(form).display == 'none') {\n      form.style.display = 'flex';\n      if (!form.hidden) form.children[0].focus();\n    } else {\n      form.style.display = 'none';\n    }\n  };\n\n  var saveEv = function saveEv(e) {\n    var target, request, res, _request, _res;\n\n    return _regeneratorRuntime.async(function saveEv$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            target = e.target.closest('.save').children[0]; //定义save按钮元素\n\n            target.classList.toggle('icon-shoucang1');\n\n            if (!target.classList.contains('icon-shoucang1')) {\n              _context.next = 14;\n              break;\n            }\n\n            _context.next = 5;\n            return _regeneratorRuntime.awrap(fetch(\"http://localhost:3001/post/save/\".concat(id), {\n              method: 'POST',\n              credentials: \"include\"\n            }));\n\n          case 5:\n            request = _context.sent;\n            if (request.status == 404) Router.push('/');\n            if (request.status == 303) target.classList.remove('icon-shoucang1');\n            _context.next = 10;\n            return _regeneratorRuntime.awrap(request.json());\n\n          case 10:\n            res = _context.sent;\n            alert(res);\n            _context.next = 22;\n            break;\n\n          case 14:\n            _context.next = 16;\n            return _regeneratorRuntime.awrap(fetch(\"http://localhost:3001/post/save/remove/\".concat(id), {\n              method: 'POST',\n              credentials: \"include\"\n            }));\n\n          case 16:\n            _request = _context.sent;\n            if (_request.status == 404) Router.push('/');\n            _context.next = 20;\n            return _regeneratorRuntime.awrap(_request.json());\n\n          case 20:\n            _res = _context.sent;\n            alert(_res);\n\n          case 22:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    });\n  };\n\n  var likeEv = function likeEv(e) {\n    var target, request, res, _request2, _res2;\n\n    return _regeneratorRuntime.async(function likeEv$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            target = e.target.closest('.like').children[0]; //定义like按钮元素\n\n            target.classList.toggle('icon-dianzan1');\n\n            if (!target.classList.contains('icon-dianzan1')) {\n              _context2.next = 14;\n              break;\n            }\n\n            _context2.next = 5;\n            return _regeneratorRuntime.awrap(fetch(\"http://localhost:3001/post/like/\".concat(id), {\n              method: 'POST',\n              credentials: \"include\"\n            }));\n\n          case 5:\n            request = _context2.sent;\n            if (request.status == 404) Router.push('/');\n            if (request.status == 303) target.classList.remove('icon-dianzan1');\n            _context2.next = 10;\n            return _regeneratorRuntime.awrap(request.json());\n\n          case 10:\n            res = _context2.sent;\n            alert(res);\n            _context2.next = 22;\n            break;\n\n          case 14:\n            _context2.next = 16;\n            return _regeneratorRuntime.awrap(fetch(\"http://localhost:3001/post/like/remove/\".concat(id), {\n              method: 'POST',\n              credentials: \"include\"\n            }));\n\n          case 16:\n            _request2 = _context2.sent;\n            if (_request2.status == 404) Router.push('/');\n            _context2.next = 20;\n            return _regeneratorRuntime.awrap(_request2.json());\n\n          case 20:\n            _res2 = _context2.sent;\n            alert(_res2);\n\n          case 22:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    });\n  };\n\n  return __jsx(\"div\", {\n    className: \"jsx-917502157\" + \" \" + \"features\"\n  }, __jsx(CommentList, {\n    ref: formRef,\n    id: id,\n    comment: comment\n  }), __jsx(\"div\", {\n    ref: function ref(_ref2) {\n      return buAllRef = _ref2;\n    },\n    className: \"jsx-917502157\" + \" \" + \"button-All\"\n  }, __jsx(\"div\", {\n    onClick: likeEv,\n    className: \"jsx-917502157\" + \" \" + \"like\"\n  }, __jsx(\"i\", {\n    className: \"jsx-917502157\" + \" \" + 'iconfont icon-dianzan'\n  }), __jsx(\"h4\", {\n    className: \"jsx-917502157\"\n  }, \"Like\")), __jsx(\"div\", {\n    onClick: saveEv,\n    className: \"jsx-917502157\" + \" \" + \"save\"\n  }, __jsx(\"i\", {\n    className: \"jsx-917502157\" + \" \" + 'iconfont icon-shoucang'\n  }), __jsx(\"h4\", {\n    className: \"jsx-917502157\"\n  }, \"save\")), __jsx(\"div\", {\n    onClick: commentEv,\n    className: \"jsx-917502157\" + \" \" + \"comment\"\n  }, __jsx(\"i\", {\n    className: \"jsx-917502157\" + \" \" + 'iconfont icon-pinglun'\n  }), __jsx(\"h4\", {\n    className: \"jsx-917502157\"\n  }, \"comment\")), __jsx(\"div\", {\n    className: \"jsx-917502157\" + \" \" + \"share\"\n  }, __jsx(\"i\", {\n    className: \"jsx-917502157\" + \" \" + 'iconfont icon-fenxiang'\n  }), __jsx(\"h4\", {\n    className: \"jsx-917502157\"\n  }, \"share\"))), __jsx(_JSXStyle, {\n    id: \"917502157\"\n  }, [\"i.jsx-917502157{font-size:30px;margin-right:6px;}\", \".icon-dianzan1.jsx-917502157{color:#E84F43;-webkit-animation:click-jsx-917502157 0.5s 1;animation:click-jsx-917502157 0.5s 1;}\", \".icon-shoucang1.jsx-917502157{color:#FFF710;-webkit-animation:click-jsx-917502157 0.5s 1;animation:click-jsx-917502157 0.5s 1;}\", \"@-webkit-keyframes click-jsx-917502157{0%{-webkit-transform:scale(0);-ms-transform:scale(0);transform:scale(0);}100%{-webkit-transform:scale(1);-ms-transform:scale(1);transform:scale(1);}}\", \"@keyframes click-jsx-917502157{0%{-webkit-transform:scale(0);-ms-transform:scale(0);transform:scale(0);}100%{-webkit-transform:scale(1);-ms-transform:scale(1);transform:scale(1);}}\", \".button-All.jsx-917502157{width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:8vh;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}\", \".button-All.jsx-917502157>div.jsx-917502157{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:1;-ms-flex:1;flex:1;height:6vh;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-right:4vh;opacity:0.5;}\", \".button-All.jsx-917502157>div.jsx-917502157:hover{opacity:1;}\", \".like.jsx-917502157{margin-left:4vh;}\", \".share.jsx-917502157 svg.jsx-917502157{margin-right:0.4vh;}\", \"svg.jsx-917502157{height:50%;}\"]));\n}\n\nexport default Features;","map":null,"metadata":{},"sourceType":"module"}