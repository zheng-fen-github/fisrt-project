{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nvar _jsxFileName = \"C:\\\\test\\\\component\\\\home\\\\addcontent\\\\addPhoto\\\\addphoto.js\";\nimport _JSXStyle from \"styled-jsx/style\";\nvar __jsx = React.createElement;\nimport React, { useState } from 'react';\nimport Top from './addPhototop';\nimport Content from './addphotolist';\nimport Form from './postform/form';\nimport AddBu from './addbu';\nimport { useRouter } from 'next/router';\nimport Loading from '../../../public/loading';\n\nfunction AddPhoto() {\n  var data = useRouter();\n\n  var _useState = useState([]),\n      PhotoFiles = _useState[0],\n      setPhotoFiles = _useState[1];\n\n  var _useState2 = useState(false),\n      fetching = _useState2[0],\n      setFetching = _useState2[1];\n\n  var fileRef = React.createRef(); // file Dom 定义\n\n  var canvasRef;\n\n  var fileClick = function fileClick() {\n    // 添加图片FileDOM 点击事件\n    fileRef.current.click();\n  };\n\n  var uploadPhoto = function uploadPhoto(e) {\n    var reming, formData, filesPromises;\n    return _regeneratorRuntime.async(function uploadPhoto$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            e.preventDefault();\n\n            if (!(PhotoFiles.length < 1)) {\n              _context2.next = 6;\n              break;\n            }\n\n            // 检测是否有照片添加\n            reming = document.querySelector('.remind');\n            reming.hidden = false;\n            setTimeout(function () {\n              return reming.hidden = true;\n            }, 2000);\n            return _context2.abrupt(\"return\");\n\n          case 6:\n            // 添加信息和照片到服务器\n            formData = new FormData(e.target);\n            formData[\"delete\"]('photoFile');\n            filesPromises = PhotoFiles.map(function _callee(photo) {\n              var img, promise, blob, file;\n              return _regeneratorRuntime.async(function _callee$(_context) {\n                while (1) {\n                  switch (_context.prev = _context.next) {\n                    case 0:\n                      img = new Image(); //裁减图片1比1。\n\n                      img.src = URL.createObjectURL(photo.file);\n                      promise = new Promise(function (resolve) {\n                        img.onload = function () {\n                          var width = img.width,\n                              height = img.height;\n                          console.log(width, height);\n                          var size = width > height ? height : width;\n                          console.log(size);\n                          var count = width > height ? width - size : height - size;\n                          var countAr = width > height ? [-count, 0] : [0, -count];\n                          console.log(countAr);\n                          canvasRef.width = size;\n                          canvasRef.height = size;\n                          canvasRef.getContext('2d').drawImage(img, -212, 0);\n                          canvasRef.toBlob(function (blob) {\n                            //  const a = document.createElement('a');\n                            //  a.href = URL.createObjectURL(blob);\n                            //  a.click();   \n                            resolve(blob);\n                          });\n                        };\n                      });\n                      _context.next = 5;\n                      return _regeneratorRuntime.awrap(promise.then(function (result) {\n                        return blob = result;\n                      }));\n\n                    case 5:\n                      file = new File([blob], photo.file.name, {\n                        type: photo.file.type\n                      });\n                      return _context.abrupt(\"return\", file);\n\n                    case 7:\n                    case \"end\":\n                      return _context.stop();\n                  }\n                }\n              }, null, null, null, Promise);\n            }); // let files;\n            // await Promise.all(filesPromises).then( file => files =file);\n            // files.forEach(file =>{\n            //     formData.append('photoFile',file)\n            // });\n            // // if(!data.account) return alert('未获取作者 程序错误');\n            // formData.append('name',name.textContent);\n            // (async () => {\n            //     // setFetching(true);\n            //     let require = await fetch('http://localhost:3001/getphoto/post',\n            //                 {method:'POST',body:formData});\n            //     let res = await require.json();\n            //     if(res)console.log(res)\n            // })() \n\n          case 9:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  return __jsx(\"div\", {\n    className: \"jsx-2222252425\" + \" \" + 'add-photo',\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82\n    },\n    __self: this\n  }, !fetching ? __jsx(React.Fragment, null, __jsx(\"div\", {\n    className: \"jsx-2222252425\" + \" \" + \"container\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84\n    },\n    __self: this\n  }, __jsx(Top, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85\n    },\n    __self: this\n  }), __jsx(\"form\", {\n    onSubmit: uploadPhoto,\n    className: \"jsx-2222252425\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86\n    },\n    __self: this\n  }, __jsx(Content, {\n    click: fileClick,\n    setPhotoFiles: setPhotoFiles,\n    PhotoFiles: PhotoFiles,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87\n    },\n    __self: this\n  }), PhotoFiles.length > 0 && __jsx(AddBu, {\n    click: fileClick,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 91\n    },\n    __self: this\n  }), __jsx(Form, {\n    ref: fileRef,\n    setFile: setPhotoFiles,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93\n    },\n    __self: this\n  }, __jsx(\"div\", {\n    onClick: function onClick(e) {\n      return e.target.hidden = true;\n    },\n    hidden: true,\n    className: \"jsx-2222252425\" + \" \" + \"remind\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94\n    },\n    __self: this\n  }, \"\\u8BF7\\u6DFB\\u52A0\\u81F3\\u5C11\\u4E00\\u5F20\\u7167\\u7247\")))), __jsx(\"canvas\", {\n    ref: function ref(_ref) {\n      return canvasRef = _ref;\n    },\n    width: \"400\",\n    height: \"400\",\n    style: {\n      position: 'fixed',\n      left: 0,\n      top: 0,\n      zIndex: 99\n    },\n    className: \"jsx-2222252425\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100\n    },\n    __self: this\n  })) : __jsx(Loading, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103\n    },\n    __self: this\n  }), __jsx(_JSXStyle, {\n    id: \"2222252425\",\n    __self: this\n  }, \".add-photo.jsx-2222252425{position:fixed;top:0;left:0;height:100vh;width:100vw;background:#f4f7f9;z-index:10;}.user.jsx-2222252425{position:fixed;top:50%;left:40px;-webkit-transform:translate(0,-50%);-ms-transform:translate(0,-50%);transform:translate(0,-50%);}.container.jsx-2222252425::-webkit-scrollbar{display:none;}.container.jsx-2222252425{height:100%;width:980px;margin:0 auto;background:white;box-shadow:0 0 4px #eee;overflow:auto;padding-bottom:40vh;}.remind.jsx-2222252425{width:90%;height:50px;border-radius:12px;color:white;text-align:center;line-height:50px;font-size:20px;background:red;-webkit-animation:go-jsx-2222252425 .2s;animation:go-jsx-2222252425 .2s;}@-webkit-keyframes go-jsx-2222252425{0%{-webkit-transform:scale(0.8);-ms-transform:scale(0.8);transform:scale(0.8);}100%{-webkit-transform:scale(1);-ms-transform:scale(1);transform:scale(1);}}@keyframes go-jsx-2222252425{0%{-webkit-transform:scale(0.8);-ms-transform:scale(0.8);transform:scale(0.8);}100%{-webkit-transform:scale(1);-ms-transform:scale(1);transform:scale(1);}}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFx0ZXN0XFxjb21wb25lbnRcXGhvbWVcXGFkZGNvbnRlbnRcXGFkZFBob3RvXFxhZGRwaG90by5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUF3R3lCLEFBRytDLEFBU0EsQUFNRixBQUdELEFBU0YsQUFZZSxBQUdGLFVBZFgsRUFUQSxDQUhmLEVBZlMsQUFTRSxNQVJELENBMkJZLENBbEJULENBU0ksSUFqQkQsS0FTZSxLQVNYLEdBakJMLEFBMEJBLFlBekJPLEFBMEJELEVBVE0sY0FxQnZCLEVBWGdCLENBMUJOLEdBa0NWLElBakJhLElBaEJqQixLQTBCa0IsS0FUSyxVQVVMLFVBVGxCLEtBVXFCLFdBdEJyQiw2REF1QkEiLCJmaWxlIjoiQzpcXHRlc3RcXGNvbXBvbmVudFxcaG9tZVxcYWRkY29udGVudFxcYWRkUGhvdG9cXGFkZHBob3RvLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LHt1c2VTdGF0ZX0gZnJvbSAncmVhY3QnXHJcbmltcG9ydCBUb3AgZnJvbSAnLi9hZGRQaG90b3RvcCdcclxuaW1wb3J0IENvbnRlbnQgZnJvbSAnLi9hZGRwaG90b2xpc3QnXHJcbmltcG9ydCBGb3JtIGZyb20gJy4vcG9zdGZvcm0vZm9ybSdcclxuaW1wb3J0IEFkZEJ1IGZyb20gJy4vYWRkYnUnXHJcbmltcG9ydCB7dXNlUm91dGVyfSBmcm9tICduZXh0L3JvdXRlcidcclxuaW1wb3J0IExvYWRpbmcgZnJvbSAnLi4vLi4vLi4vcHVibGljL2xvYWRpbmcnXHJcblxyXG5mdW5jdGlvbiBBZGRQaG90bygpIHtcclxuICAgIGNvbnN0IGRhdGEgPSB1c2VSb3V0ZXIoKTtcclxuICAgIGNvbnN0IFtQaG90b0ZpbGVzLCBzZXRQaG90b0ZpbGVzXSA9IHVzZVN0YXRlKFtdKTtcclxuICAgIGNvbnN0IFtmZXRjaGluZyxzZXRGZXRjaGluZ10gPSB1c2VTdGF0ZShmYWxzZSk7XHJcbiAgICBjb25zdCBmaWxlUmVmID0gUmVhY3QuY3JlYXRlUmVmKCk7IC8vIGZpbGUgRG9tIOWumuS5iVxyXG4gICAgbGV0IGNhbnZhc1JlZjsgXHJcblxyXG4gICAgY29uc3QgZmlsZUNsaWNrID0gKCkgPT4geyAgICAgIC8vIOa3u+WKoOWbvueJh0ZpbGVET00g54K55Ye75LqL5Lu2XHJcbiAgICAgICAgZmlsZVJlZi5jdXJyZW50LmNsaWNrKCk7IFxyXG4gICAgfSBcclxuICAgIGNvbnN0IHVwbG9hZFBob3RvID1hc3luYyAoZSkgPT4ge1xyXG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICBpZihQaG90b0ZpbGVzLmxlbmd0aDwxKSB7ICAgICAgICAgICAvLyDmo4DmtYvmmK/lkKbmnInnhafniYfmt7vliqBcclxuICAgICAgICAgICAgbGV0IHJlbWluZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5yZW1pbmQnKTsgICAgICAgICAgICBcclxuICAgICAgICAgICAgcmVtaW5nLmhpZGRlbiA9IGZhbHNlO1xyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHJlbWluZy5oaWRkZW4gPSB0cnVlLDIwMDApO1xyXG4gICAgICAgICAgICByZXR1cm5cclxuICAgICAgICB9ICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyDmt7vliqDkv6Hmga/lkoznhafniYfliLDmnI3liqHlmahcclxuICAgICAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YShlLnRhcmdldCk7XHJcbiAgICAgICAgZm9ybURhdGEuZGVsZXRlKCdwaG90b0ZpbGUnKTtcclxuICAgICAgICBsZXQgZmlsZXNQcm9taXNlcyA9IFBob3RvRmlsZXMubWFwKCBhc3luYyAocGhvdG8pID0+IHsgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICBsZXQgaW1nID0gbmV3IEltYWdlKCk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL+ijgeWHj+WbvueJhzHmr5Qx44CCXHJcbiAgICAgICAgICAgICAgICAgICAgaW1nLnNyYyA9IFVSTC5jcmVhdGVPYmplY3RVUkwocGhvdG8uZmlsZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbWcub25sb2FkID0gKCkgPT57XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQge3dpZHRoLGhlaWdodH0gID0gaW1nOyAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHdpZHRoLGhlaWdodCkgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHNpemUgPSB3aWR0aD5oZWlnaHQ/aGVpZ2h0OndpZHRoO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coc2l6ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgY291bnQgPSB3aWR0aD5oZWlnaHQ/d2lkdGgtc2l6ZTpoZWlnaHQtc2l6ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBjb3VudEFyID0gd2lkdGg+aGVpZ2h0P1stY291bnQsMF06WzAsLWNvdW50XTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGNvdW50QXIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FudmFzUmVmLndpZHRoID0gc2l6ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbnZhc1JlZi5oZWlnaHQgPSBzaXplOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FudmFzUmVmLmdldENvbnRleHQoJzJkJykuZHJhd0ltYWdlKGltZywtMjEyLDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FudmFzUmVmLnRvQmxvYihibG9iID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBjb25zdCBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIGEuaHJlZiA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgYS5jbGljaygpOyAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoYmxvYilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gIFxyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGJsb2I7XHJcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgcHJvbWlzZS50aGVuKHJlc3VsdCA9PiBibG9iID0gcmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgZmlsZSA9IG5ldyBGaWxlKFtibG9iXSxwaG90by5maWxlLm5hbWUse1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOnBob3RvLmZpbGUudHlwZSxcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmaWxlOyAgICAgICAgICAgIFxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIC8vIGxldCBmaWxlcztcclxuICAgICAgICAvLyBhd2FpdCBQcm9taXNlLmFsbChmaWxlc1Byb21pc2VzKS50aGVuKCBmaWxlID0+IGZpbGVzID1maWxlKTtcclxuICAgICAgIFxyXG4gICAgICAgIC8vIGZpbGVzLmZvckVhY2goZmlsZSA9PntcclxuICAgICAgICAvLyAgICAgZm9ybURhdGEuYXBwZW5kKCdwaG90b0ZpbGUnLGZpbGUpXHJcbiAgICAgICAgLy8gfSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gLy8gaWYoIWRhdGEuYWNjb3VudCkgcmV0dXJuIGFsZXJ0KCfmnKrojrflj5bkvZzogIUg56iL5bqP6ZSZ6K+vJyk7XHJcbiAgICAgICAgLy8gZm9ybURhdGEuYXBwZW5kKCduYW1lJyxuYW1lLnRleHRDb250ZW50KTtcclxuICAgICAgICBcclxuICAgICAgXHJcbiAgICAgICAgLy8gKGFzeW5jICgpID0+IHtcclxuICAgICAgICAvLyAgICAgLy8gc2V0RmV0Y2hpbmcodHJ1ZSk7XHJcbiAgICAgICAgLy8gICAgIGxldCByZXF1aXJlID0gYXdhaXQgZmV0Y2goJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMS9nZXRwaG90by9wb3N0JyxcclxuICAgICAgICAvLyAgICAgICAgICAgICAgICAge21ldGhvZDonUE9TVCcsYm9keTpmb3JtRGF0YX0pO1xyXG4gICAgICAgIC8vICAgICBsZXQgcmVzID0gYXdhaXQgcmVxdWlyZS5qc29uKCk7XHJcbiAgICAgICAgLy8gICAgIGlmKHJlcyljb25zb2xlLmxvZyhyZXMpXHJcbiAgICAgICAgLy8gfSkoKSBcclxuICAgICAgICAgICAgICAgICBcclxuICAgIH1cclxuICAgIHJldHVybiAoXHJcbiAgICAgICAgPGRpdiBjbGFzc05hbWU9J2FkZC1waG90byc+XHJcbiAgICAgICAgICB7IWZldGNoaW5nPzw+XHJcbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJjb250YWluZXJcIj5cclxuICAgICAgICAgICAgICAgICAgICA8VG9wLz5cclxuICAgICAgICAgICAgICAgICAgICA8Zm9ybSBvblN1Ym1pdD17dXBsb2FkUGhvdG99PlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPENvbnRlbnQgY2xpY2s9e2ZpbGVDbGlja31cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRQaG90b0ZpbGVzPXtzZXRQaG90b0ZpbGVzfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBob3RvRmlsZXM9e1Bob3RvRmlsZXN9Lz5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7UGhvdG9GaWxlcy5sZW5ndGg+MCAmJiA8QWRkQnUgY2xpY2s9e2ZpbGVDbGlja30vPn1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8Rm9ybSByZWY9e2ZpbGVSZWZ9IHNldEZpbGU9e3NldFBob3RvRmlsZXN9PiBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cInJlbWluZFwiIG9uQ2xpY2s9eyhlKSA9PmUudGFyZ2V0LmhpZGRlbiA9IHRydWUgfSBoaWRkZW4+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDor7fmt7vliqDoh7PlsJHkuIDlvKDnhafniYdcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvRm9ybT5cclxuICAgICAgICAgICAgICAgICAgICA8L2Zvcm0+XHJcbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgICAgICAgPGNhbnZhcyByZWY9e3JlZiA9PiBjYW52YXNSZWYgPSByZWZ9IHdpZHRoPSc0MDAnIGhlaWdodD0nNDAwJyBzdHlsZT17e3Bvc2l0aW9uOidmaXhlZCcsbGVmdDowLHRvcDowLHpJbmRleDo5OX19PlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICA8L2NhbnZhcz5cclxuICAgICAgICAgICAgICAgICA8Lz46PExvYWRpbmcvPn1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIDxzdHlsZSBqc3g+IHtgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWRkLXBob3RvIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjpmaXhlZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6MDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OjA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OjEwMHZoO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOjEwMHZ3O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6I2Y0ZjdmOTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB6LWluZGV4OjEwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnVzZXJ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246Zml4ZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wOjUwJTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OjQwcHg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtOnRyYW5zbGF0ZSgwLC01MCUpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNvbnRhaW5lcjo6LXdlYmtpdC1zY3JvbGxiYXIge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6bm9uZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jb250YWluZXIge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDoxMDAlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOjk4MHB4O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcmdpbjowIGF1dG87XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZDp3aGl0ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib3gtc2hhZG93OjAgMCA0cHggI2VlZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdmVyZmxvdzphdXRvO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZGRpbmctYm90dG9tOjQwdmg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVtaW5kIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDo5MCU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OjUwcHg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9yZGVyLXJhZGl1czoxMnB4O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOndoaXRlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQtYWxpZ246Y2VudGVyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmUtaGVpZ2h0OjUwcHg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9udC1zaXplOjIwcHg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZDpyZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW9uOiBnbyAuMnM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBAa2V5ZnJhbWVzIGdvIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAwJSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybTpzY2FsZSgwLjgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxMDAlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtOnNjYWxlKDEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGB9XHJcbiAgICAgICAgICAgIDwvc3R5bGU+XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgICApXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IEFkZFBob3RvXHJcbiJdfQ== */\\n/*@ sourceURL=C:\\\\\\\\test\\\\\\\\component\\\\\\\\home\\\\\\\\addcontent\\\\\\\\addPhoto\\\\\\\\addphoto.js */\"));\n}\n\nexport default AddPhoto;","map":{"version":3,"sources":["C:/test/component/home/addcontent/addPhoto/addphoto.js"],"names":["React","useState","Top","Content","Form","AddBu","useRouter","Loading","AddPhoto","data","PhotoFiles","setPhotoFiles","fetching","setFetching","fileRef","createRef","canvasRef","fileClick","current","click","uploadPhoto","e","preventDefault","length","reming","document","querySelector","hidden","setTimeout","formData","FormData","target","filesPromises","map","photo","img","Image","src","URL","createObjectURL","file","promise","Promise","resolve","onload","width","height","console","log","size","count","countAr","getContext","drawImage","toBlob","blob","then","result","File","name","type","ref","position","left","top","zIndex"],"mappings":"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","sourcesContent":["import React,{useState} from 'react'\r\nimport Top from './addPhototop'\r\nimport Content from './addphotolist'\r\nimport Form from './postform/form'\r\nimport AddBu from './addbu'\r\nimport {useRouter} from 'next/router'\r\nimport Loading from '../../../public/loading'\r\n\r\nfunction AddPhoto() {\r\n    const data = useRouter();\r\n    const [PhotoFiles, setPhotoFiles] = useState([]);\r\n    const [fetching,setFetching] = useState(false);\r\n    const fileRef = React.createRef(); // file Dom 定义\r\n    let canvasRef; \r\n\r\n    const fileClick = () => {      // 添加图片FileDOM 点击事件\r\n        fileRef.current.click(); \r\n    } \r\n    const uploadPhoto =async (e) => {\r\n        e.preventDefault();\r\n        if(PhotoFiles.length<1) {           // 检测是否有照片添加\r\n            let reming = document.querySelector('.remind');            \r\n            reming.hidden = false;\r\n            setTimeout(() => reming.hidden = true,2000);\r\n            return\r\n        }          \r\n            // 添加信息和照片到服务器\r\n        const formData = new FormData(e.target);\r\n        formData.delete('photoFile');\r\n        let filesPromises = PhotoFiles.map( async (photo) => {            \r\n                    let img = new Image();                             //裁减图片1比1。\r\n                    img.src = URL.createObjectURL(photo.file);\r\n                    let promise = new Promise((resolve) => {\r\n                        img.onload = () =>{\r\n                            let {width,height}  = img;    \r\n                            console.log(width,height)                       \r\n                            let size = width>height?height:width;\r\n                            console.log(size);\r\n                            let count = width>height?width-size:height-size;\r\n                            let countAr = width>height?[-count,0]:[0,-count];\r\n                            console.log(countAr);\r\n                            canvasRef.width = size;\r\n                            canvasRef.height = size;                                                \r\n                            canvasRef.getContext('2d').drawImage(img,-212,0);\r\n                            canvasRef.toBlob(blob => {\r\n                            //  const a = document.createElement('a');\r\n                            //  a.href = URL.createObjectURL(blob);\r\n                            //  a.click();   \r\n                             resolve(blob)\r\n                            })\r\n                        }  \r\n                    })\r\n                    let blob;\r\n                    await promise.then(result => blob = result);\r\n                    let file = new File([blob],photo.file.name,{\r\n                        type:photo.file.type,\r\n                    })\r\n                    return file;            \r\n        });\r\n        // let files;\r\n        // await Promise.all(filesPromises).then( file => files =file);\r\n       \r\n        // files.forEach(file =>{\r\n        //     formData.append('photoFile',file)\r\n        // });\r\n        \r\n        \r\n        // // if(!data.account) return alert('未获取作者 程序错误');\r\n        // formData.append('name',name.textContent);\r\n        \r\n      \r\n        // (async () => {\r\n        //     // setFetching(true);\r\n        //     let require = await fetch('http://localhost:3001/getphoto/post',\r\n        //                 {method:'POST',body:formData});\r\n        //     let res = await require.json();\r\n        //     if(res)console.log(res)\r\n        // })() \r\n                 \r\n    }\r\n    return (\r\n        <div className='add-photo'>\r\n          {!fetching?<>\r\n                    <div className=\"container\">\r\n                    <Top/>\r\n                    <form onSubmit={uploadPhoto}>\r\n                            <Content click={fileClick}\r\n                                setPhotoFiles={setPhotoFiles}\r\n                                PhotoFiles={PhotoFiles}/>\r\n\r\n                            {PhotoFiles.length>0 && <AddBu click={fileClick}/>}\r\n\r\n                            <Form ref={fileRef} setFile={setPhotoFiles}> \r\n                                <div className=\"remind\" onClick={(e) =>e.target.hidden = true } hidden>\r\n                                        请添加至少一张照片\r\n                                </div>\r\n                            </Form>\r\n                    </form>\r\n                    </div>\r\n                    <canvas ref={ref => canvasRef = ref} width='400' height='400' style={{position:'fixed',left:0,top:0,zIndex:99}}>\r\n                        \r\n                    </canvas>\r\n                 </>:<Loading/>}\r\n            \r\n            <style jsx> {`\r\n                            .add-photo {\r\n                                position:fixed;\r\n                                top:0;\r\n                                left:0;\r\n                                height:100vh;\r\n                                width:100vw;\r\n                                background:#f4f7f9;\r\n                                z-index:10;\r\n                            }\r\n                            .user{\r\n                                position:fixed;\r\n                                top:50%;\r\n                                left:40px;\r\n                                transform:translate(0,-50%);                                                                                                \r\n                            }\r\n                            .container::-webkit-scrollbar {\r\n                                display:none;\r\n                            }\r\n                            .container {\r\n                                height:100%;\r\n                                width:980px;\r\n                                margin:0 auto;\r\n                                background:white;\r\n                                box-shadow:0 0 4px #eee;\r\n                                overflow:auto;\r\n                                padding-bottom:40vh;\r\n                            }\r\n                            .remind {\r\n                                width:90%;\r\n                                height:50px;\r\n                                border-radius:12px;\r\n                                color:white;\r\n                                text-align:center;\r\n                                line-height:50px;\r\n                                font-size:20px;\r\n                                background:red;\r\n                                animation: go .2s;\r\n                            }\r\n                            @keyframes go {\r\n                                0% {\r\n                                    transform:scale(0.8);\r\n                                }\r\n                                100% {\r\n                                    transform:scale(1);\r\n                                }\r\n                            }\r\n                            `}\r\n            </style>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default AddPhoto\r\n"]},"metadata":{},"sourceType":"module"}