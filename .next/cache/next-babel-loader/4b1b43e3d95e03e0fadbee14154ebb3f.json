{"ast":null,"code":"var _jsxFileName = \"C:\\\\test\\\\component\\\\home\\\\addcontent\\\\addPhoto\\\\addphoto.js\";\nimport _JSXStyle from \"styled-jsx/style\";\nvar __jsx = React.createElement;\nimport React, { useState } from 'react';\nimport Top from './addPhototop';\nimport Content from './addphotolist';\nimport Form from './postform/form';\nimport AddBu from './addbu';\nimport { useRouter } from 'next/router';\n\nfunction AddPhoto() {\n  const data = useRouter();\n  const {\n    0: PhotoFiles,\n    1: setPhotoFiles\n  } = useState([]);\n  const fileRef = React.createRef(); // file Dom 定义\n\n  let canvasRef;\n\n  const fileClick = () => {\n    // 添加图片FileDOM 点击事件\n    fileRef.current.click();\n  };\n\n  const uploadPhoto = async e => {\n    e.preventDefault();\n\n    if (PhotoFiles.length < 1) {\n      // 检测是否有照片添加\n      let reming = document.querySelector('.remind');\n      reming.hidden = false;\n      setTimeout(() => reming.hidden = true, 2000);\n      return;\n    } // 添加信息和照片到服务器\n\n\n    const formData = new FormData(e.target);\n    formData.delete('photoFile');\n    let filesPromises = PhotoFiles.map(async photo => {\n      let img = new Image(); //裁减图片1比1。\n\n      img.src = URL.createObjectURL(photo.file);\n      let promise = new Promise(resolve => {\n        img.onload = () => {\n          let {\n            width,\n            height\n          } = img;\n          let size = width > height ? height : width;\n          let count = width > height ? width - size : height - size;\n          let countAr = width > height ? [-count, 0] : [0, -count];\n          canvasRef.width = size;\n          canvasRef.height = size;\n          canvasRef.getContext('2d').drawImage(img, ...countAr);\n          canvasRef.toBlob(blob => {\n            resolve(blob);\n          });\n        };\n      });\n      let blob;\n      await promise.then(result => blob = result);\n      let file = new File([blob], photo.file.name, {\n        type: photo.file.type\n      });\n      return file;\n    });\n    let files;\n    await Promise.all(filesPromises).then(file => files = file);\n    files.forEach(file => {\n      formData.append('photoFile', file);\n    });\n    if (!data.account) return alert('未获取作者 程序错误');\n    formData.append('name', name.textContent);\n\n    (async () => {\n      let require = await fetch('http://localhost:3001/getphoto/post', {\n        method: 'POST',\n        body: formData\n      });\n\n      let res = await require.json();\n      if (res) console.log(res);\n    })();\n  };\n\n  return __jsx(\"div\", {\n    className: \"jsx-2222252425\" + \" \" + 'add-photo',\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 73\n    },\n    __self: this\n  }, __jsx(\"div\", {\n    className: \"jsx-2222252425\" + \" \" + \"container\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 74\n    },\n    __self: this\n  }, __jsx(Top, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75\n    },\n    __self: this\n  }), __jsx(\"form\", {\n    onSubmit: uploadPhoto,\n    className: \"jsx-2222252425\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 76\n    },\n    __self: this\n  }, __jsx(Content, {\n    click: fileClick,\n    setPhotoFiles: setPhotoFiles,\n    PhotoFiles: PhotoFiles,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 77\n    },\n    __self: this\n  }), PhotoFiles.length > 0 && __jsx(AddBu, {\n    click: fileClick,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81\n    },\n    __self: this\n  }), __jsx(Form, {\n    ref: fileRef,\n    setFile: setPhotoFiles,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83\n    },\n    __self: this\n  }, __jsx(\"div\", {\n    onClick: e => e.target.hidden = true,\n    hidden: true,\n    className: \"jsx-2222252425\" + \" \" + \"remind\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84\n    },\n    __self: this\n  }, \"\\u8BF7\\u6DFB\\u52A0\\u81F3\\u5C11\\u4E00\\u5F20\\u7167\\u7247\")))), __jsx(\"canvas\", {\n    ref: ref => canvasRef = ref,\n    hidden: true,\n    style: {\n      position: 'fixed',\n      left: 0,\n      top: 0,\n      zIndex: 99\n    },\n    className: \"jsx-2222252425\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90\n    },\n    __self: this\n  }), __jsx(_JSXStyle, {\n    id: \"2222252425\",\n    __self: this\n  }, \".add-photo.jsx-2222252425{position:fixed;top:0;left:0;height:100vh;width:100vw;background:#f4f7f9;z-index:10;}.user.jsx-2222252425{position:fixed;top:50%;left:40px;-webkit-transform:translate(0,-50%);-ms-transform:translate(0,-50%);transform:translate(0,-50%);}.container.jsx-2222252425::-webkit-scrollbar{display:none;}.container.jsx-2222252425{height:100%;width:980px;margin:0 auto;background:white;box-shadow:0 0 4px #eee;overflow:auto;padding-bottom:40vh;}.remind.jsx-2222252425{width:90%;height:50px;border-radius:12px;color:white;text-align:center;line-height:50px;font-size:20px;background:red;-webkit-animation:go-jsx-2222252425 .2s;animation:go-jsx-2222252425 .2s;}@-webkit-keyframes go-jsx-2222252425{0%{-webkit-transform:scale(0.8);-ms-transform:scale(0.8);transform:scale(0.8);}100%{-webkit-transform:scale(1);-ms-transform:scale(1);transform:scale(1);}}@keyframes go-jsx-2222252425{0%{-webkit-transform:scale(0.8);-ms-transform:scale(0.8);transform:scale(0.8);}100%{-webkit-transform:scale(1);-ms-transform:scale(1);transform:scale(1);}}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFx0ZXN0XFxjb21wb25lbnRcXGhvbWVcXGFkZGNvbnRlbnRcXGFkZFBob3RvXFxhZGRwaG90by5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUE0RnlCLEFBRytDLEFBU0EsQUFNRixBQUdELEFBU0YsQUFZZSxBQUdGLFVBZFgsRUFUQSxDQUhmLEVBZlMsQUFTRSxNQVJELENBMkJZLENBbEJULENBU0ksSUFqQkQsS0FTZSxLQVNYLEdBakJMLEFBMEJBLFlBekJPLEFBMEJELEVBVE0sY0FxQnZCLEVBWGdCLENBMUJOLEdBa0NWLElBakJhLElBaEJqQixLQTBCa0IsS0FUSyxVQVVMLFVBVGxCLEtBVXFCLFdBdEJyQiw2REF1QkEiLCJmaWxlIjoiQzpcXHRlc3RcXGNvbXBvbmVudFxcaG9tZVxcYWRkY29udGVudFxcYWRkUGhvdG9cXGFkZHBob3RvLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LHt1c2VTdGF0ZX0gZnJvbSAncmVhY3QnXHJcbmltcG9ydCBUb3AgZnJvbSAnLi9hZGRQaG90b3RvcCdcclxuaW1wb3J0IENvbnRlbnQgZnJvbSAnLi9hZGRwaG90b2xpc3QnXHJcbmltcG9ydCBGb3JtIGZyb20gJy4vcG9zdGZvcm0vZm9ybSdcclxuaW1wb3J0IEFkZEJ1IGZyb20gJy4vYWRkYnUnXHJcbmltcG9ydCB7dXNlUm91dGVyfSBmcm9tICduZXh0L3JvdXRlcidcclxuXHJcbmZ1bmN0aW9uIEFkZFBob3RvKCkge1xyXG4gICAgY29uc3QgZGF0YSA9IHVzZVJvdXRlcigpO1xyXG4gICAgY29uc3QgW1Bob3RvRmlsZXMsIHNldFBob3RvRmlsZXNdID0gdXNlU3RhdGUoW10pO1xyXG4gICAgY29uc3QgZmlsZVJlZiA9IFJlYWN0LmNyZWF0ZVJlZigpOyAvLyBmaWxlIERvbSDlrprkuYlcclxuICAgIGxldCBjYW52YXNSZWY7IFxyXG5cclxuICAgIGNvbnN0IGZpbGVDbGljayA9ICgpID0+IHsgICAgICAvLyDmt7vliqDlm77niYdGaWxlRE9NIOeCueWHu+S6i+S7tlxyXG4gICAgICAgIGZpbGVSZWYuY3VycmVudC5jbGljaygpOyBcclxuICAgIH0gXHJcbiAgICBjb25zdCB1cGxvYWRQaG90byA9YXN5bmMgKGUpID0+IHtcclxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgaWYoUGhvdG9GaWxlcy5sZW5ndGg8MSkgeyAgICAgICAgICAgLy8g5qOA5rWL5piv5ZCm5pyJ54Wn54mH5re75YqgXHJcbiAgICAgICAgICAgIGxldCByZW1pbmcgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucmVtaW5kJyk7ICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHJlbWluZy5oaWRkZW4gPSBmYWxzZTtcclxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiByZW1pbmcuaGlkZGVuID0gdHJ1ZSwyMDAwKTtcclxuICAgICAgICAgICAgcmV0dXJuXHJcbiAgICAgICAgfSAgICAgICAgICBcclxuICAgICAgICAgICAgLy8g5re75Yqg5L+h5oGv5ZKM54Wn54mH5Yiw5pyN5Yqh5ZmoXHJcbiAgICAgICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoZS50YXJnZXQpO1xyXG4gICAgICAgIGZvcm1EYXRhLmRlbGV0ZSgncGhvdG9GaWxlJyk7XHJcbiAgICAgICAgbGV0IGZpbGVzUHJvbWlzZXMgPSBQaG90b0ZpbGVzLm1hcCggYXN5bmMgKHBob3RvKSA9PiB7ICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGltZyA9IG5ldyBJbWFnZSgpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy/oo4Hlh4/lm77niYcx5q+UMeOAglxyXG4gICAgICAgICAgICAgICAgICAgIGltZy5zcmMgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKHBob3RvLmZpbGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBwcm9taXNlID0gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW1nLm9ubG9hZCA9ICgpID0+e1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHt3aWR0aCxoZWlnaHR9ICA9IGltZzsgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBzaXplID0gd2lkdGg+aGVpZ2h0P2hlaWdodDp3aWR0aDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBjb3VudCA9IHdpZHRoPmhlaWdodD93aWR0aC1zaXplOmhlaWdodC1zaXplO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGNvdW50QXIgPSB3aWR0aD5oZWlnaHQ/Wy1jb3VudCwwXTpbMCwtY291bnRdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FudmFzUmVmLndpZHRoID0gc2l6ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbnZhc1JlZi5oZWlnaHQgPSBzaXplOyAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW52YXNSZWYuZ2V0Q29udGV4dCgnMmQnKS5kcmF3SW1hZ2UoaW1nLC4uLmNvdW50QXIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FudmFzUmVmLnRvQmxvYihibG9iID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoYmxvYilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gIFxyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGJsb2I7XHJcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgcHJvbWlzZS50aGVuKHJlc3VsdCA9PiBibG9iID0gcmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgZmlsZSA9IG5ldyBGaWxlKFtibG9iXSxwaG90by5maWxlLm5hbWUse1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOnBob3RvLmZpbGUudHlwZSxcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmaWxlOyAgICAgICAgICAgIFxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGxldCBmaWxlcztcclxuICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChmaWxlc1Byb21pc2VzKS50aGVuKCBmaWxlID0+IGZpbGVzID1maWxlKTtcclxuICAgICAgIFxyXG4gICAgICAgIGZpbGVzLmZvckVhY2goZmlsZSA9PntcclxuICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdwaG90b0ZpbGUnLGZpbGUpXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYoIWRhdGEuYWNjb3VudCkgcmV0dXJuIGFsZXJ0KCfmnKrojrflj5bkvZzogIUg56iL5bqP6ZSZ6K+vJyk7XHJcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKCduYW1lJyxuYW1lLnRleHRDb250ZW50KTtcclxuICAgICAgICBcclxuICAgICAgXHJcbiAgICAgICAgKGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgbGV0IHJlcXVpcmUgPSBhd2FpdCBmZXRjaCgnaHR0cDovL2xvY2FsaG9zdDozMDAxL2dldHBob3RvL3Bvc3QnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7bWV0aG9kOidQT1NUJyxib2R5OmZvcm1EYXRhfSk7XHJcbiAgICAgICAgICAgIGxldCByZXMgPSBhd2FpdCByZXF1aXJlLmpzb24oKTtcclxuICAgICAgICAgICAgaWYocmVzKWNvbnNvbGUubG9nKHJlcylcclxuICAgICAgICB9KSgpIFxyXG4gICAgICAgICAgICAgICAgIFxyXG4gICAgfVxyXG4gICAgcmV0dXJuIChcclxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT0nYWRkLXBob3RvJz5cclxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJjb250YWluZXJcIj5cclxuICAgICAgICAgICAgICAgPFRvcC8+XHJcbiAgICAgICAgICAgICAgIDxmb3JtIG9uU3VibWl0PXt1cGxvYWRQaG90b30+XHJcbiAgICAgICAgICAgICAgICAgICAgPENvbnRlbnQgY2xpY2s9e2ZpbGVDbGlja31cclxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0UGhvdG9GaWxlcz17c2V0UGhvdG9GaWxlc31cclxuICAgICAgICAgICAgICAgICAgICAgICAgUGhvdG9GaWxlcz17UGhvdG9GaWxlc30vPlxyXG5cclxuICAgICAgICAgICAgICAgICAgICB7UGhvdG9GaWxlcy5sZW5ndGg+MCAmJiA8QWRkQnUgY2xpY2s9e2ZpbGVDbGlja30vPn1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgPEZvcm0gcmVmPXtmaWxlUmVmfSBzZXRGaWxlPXtzZXRQaG90b0ZpbGVzfT4gXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwicmVtaW5kXCIgb25DbGljaz17KGUpID0+ZS50YXJnZXQuaGlkZGVuID0gdHJ1ZSB9IGhpZGRlbj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDor7fmt7vliqDoh7PlsJHkuIDlvKDnhafniYdcclxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgICAgICAgPC9Gb3JtPlxyXG4gICAgICAgICAgICAgICA8L2Zvcm0+XHJcbiAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICA8Y2FudmFzIHJlZj17cmVmID0+IGNhbnZhc1JlZiA9IHJlZn0gaGlkZGVuIHN0eWxlPXt7cG9zaXRpb246J2ZpeGVkJyxsZWZ0OjAsdG9wOjAsekluZGV4Ojk5fX0+XHJcbiAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIDwvY2FudmFzPlxyXG4gICAgICAgICAgICA8c3R5bGUganN4PiB7YFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZC1waG90byB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246Zml4ZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wOjA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDowO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDoxMDB2aDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDoxMDB2dztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiNmNGY3Zjk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgei1pbmRleDoxMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC51c2Vye1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOmZpeGVkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcDo1MCU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDo0MHB4O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybTp0cmFuc2xhdGUoMCwtNTAlKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jb250YWluZXI6Oi13ZWJraXQtc2Nyb2xsYmFyIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5Om5vbmU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY29udGFpbmVyIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6MTAwJTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDo5ODBweDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXJnaW46MCBhdXRvO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6d2hpdGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm94LXNoYWRvdzowIDAgNHB4ICNlZWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3ZlcmZsb3c6YXV0bztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWRkaW5nLWJvdHRvbTo0MHZoO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlbWluZCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6OTAlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDo1MHB4O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6MTJweDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjp3aGl0ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0LWFsaWduOmNlbnRlcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lLWhlaWdodDo1MHB4O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvbnQtc2l6ZToyMHB4O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6cmVkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogZ28gLjJzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQGtleWZyYW1lcyBnbyB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMCUge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm06c2NhbGUoMC44KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMTAwJSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybTpzY2FsZSgxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBgfVxyXG4gICAgICAgICAgICA8L3N0eWxlPlxyXG4gICAgICAgIDwvZGl2PlxyXG4gICAgKVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBBZGRQaG90b1xyXG4iXX0= */\\n/*@ sourceURL=C:\\\\\\\\test\\\\\\\\component\\\\\\\\home\\\\\\\\addcontent\\\\\\\\addPhoto\\\\\\\\addphoto.js */\"));\n}\n\nexport default AddPhoto;","map":{"version":3,"sources":["C:/test/component/home/addcontent/addPhoto/addphoto.js"],"names":["React","useState","Top","Content","Form","AddBu","useRouter","AddPhoto","data","PhotoFiles","setPhotoFiles","fileRef","createRef","canvasRef","fileClick","current","click","uploadPhoto","e","preventDefault","length","reming","document","querySelector","hidden","setTimeout","formData","FormData","target","delete","filesPromises","map","photo","img","Image","src","URL","createObjectURL","file","promise","Promise","resolve","onload","width","height","size","count","countAr","getContext","drawImage","toBlob","blob","then","result","File","name","type","files","all","forEach","append","account","alert","textContent","require","fetch","method","body","res","json","console","log","ref","position","left","top","zIndex"],"mappings":"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","sourcesContent":["import React,{useState} from 'react'\r\nimport Top from './addPhototop'\r\nimport Content from './addphotolist'\r\nimport Form from './postform/form'\r\nimport AddBu from './addbu'\r\nimport {useRouter} from 'next/router'\r\n\r\nfunction AddPhoto() {\r\n    const data = useRouter();\r\n    const [PhotoFiles, setPhotoFiles] = useState([]);\r\n    const fileRef = React.createRef(); // file Dom 定义\r\n    let canvasRef; \r\n\r\n    const fileClick = () => {      // 添加图片FileDOM 点击事件\r\n        fileRef.current.click(); \r\n    } \r\n    const uploadPhoto =async (e) => {\r\n        e.preventDefault();\r\n        if(PhotoFiles.length<1) {           // 检测是否有照片添加\r\n            let reming = document.querySelector('.remind');            \r\n            reming.hidden = false;\r\n            setTimeout(() => reming.hidden = true,2000);\r\n            return\r\n        }          \r\n            // 添加信息和照片到服务器\r\n        const formData = new FormData(e.target);\r\n        formData.delete('photoFile');\r\n        let filesPromises = PhotoFiles.map( async (photo) => {            \r\n                    let img = new Image();                             //裁减图片1比1。\r\n                    img.src = URL.createObjectURL(photo.file);\r\n                    let promise = new Promise((resolve) => {\r\n                        img.onload = () =>{\r\n                            let {width,height}  = img;                           \r\n                            let size = width>height?height:width;\r\n                            let count = width>height?width-size:height-size;\r\n                            let countAr = width>height?[-count,0]:[0,-count];\r\n                            canvasRef.width = size;\r\n                            canvasRef.height = size;                    \r\n                            canvasRef.getContext('2d').drawImage(img,...countAr);\r\n                            canvasRef.toBlob(blob => {\r\n                            resolve(blob)\r\n                            })\r\n                        }  \r\n                    })\r\n                    let blob;\r\n                    await promise.then(result => blob = result);\r\n                    let file = new File([blob],photo.file.name,{\r\n                        type:photo.file.type,\r\n                    })\r\n                    return file;            \r\n        });\r\n        let files;\r\n        await Promise.all(filesPromises).then( file => files =file);\r\n       \r\n        files.forEach(file =>{\r\n            formData.append('photoFile',file)\r\n        });\r\n        \r\n        \r\n        if(!data.account) return alert('未获取作者 程序错误');\r\n        formData.append('name',name.textContent);\r\n        \r\n      \r\n        (async () => {\r\n            let require = await fetch('http://localhost:3001/getphoto/post',\r\n                        {method:'POST',body:formData});\r\n            let res = await require.json();\r\n            if(res)console.log(res)\r\n        })() \r\n                 \r\n    }\r\n    return (\r\n        <div className='add-photo'>\r\n            <div className=\"container\">\r\n               <Top/>\r\n               <form onSubmit={uploadPhoto}>\r\n                    <Content click={fileClick}\r\n                        setPhotoFiles={setPhotoFiles}\r\n                        PhotoFiles={PhotoFiles}/>\r\n\r\n                    {PhotoFiles.length>0 && <AddBu click={fileClick}/>}\r\n\r\n                    <Form ref={fileRef} setFile={setPhotoFiles}> \r\n                        <div className=\"remind\" onClick={(e) =>e.target.hidden = true } hidden>\r\n                                请添加至少一张照片\r\n                        </div>\r\n                    </Form>\r\n               </form>\r\n            </div>\r\n            <canvas ref={ref => canvasRef = ref} hidden style={{position:'fixed',left:0,top:0,zIndex:99}}>\r\n                 \r\n            </canvas>\r\n            <style jsx> {`\r\n                            .add-photo {\r\n                                position:fixed;\r\n                                top:0;\r\n                                left:0;\r\n                                height:100vh;\r\n                                width:100vw;\r\n                                background:#f4f7f9;\r\n                                z-index:10;\r\n                            }\r\n                            .user{\r\n                                position:fixed;\r\n                                top:50%;\r\n                                left:40px;\r\n                                transform:translate(0,-50%);                                                                                                \r\n                            }\r\n                            .container::-webkit-scrollbar {\r\n                                display:none;\r\n                            }\r\n                            .container {\r\n                                height:100%;\r\n                                width:980px;\r\n                                margin:0 auto;\r\n                                background:white;\r\n                                box-shadow:0 0 4px #eee;\r\n                                overflow:auto;\r\n                                padding-bottom:40vh;\r\n                            }\r\n                            .remind {\r\n                                width:90%;\r\n                                height:50px;\r\n                                border-radius:12px;\r\n                                color:white;\r\n                                text-align:center;\r\n                                line-height:50px;\r\n                                font-size:20px;\r\n                                background:red;\r\n                                animation: go .2s;\r\n                            }\r\n                            @keyframes go {\r\n                                0% {\r\n                                    transform:scale(0.8);\r\n                                }\r\n                                100% {\r\n                                    transform:scale(1);\r\n                                }\r\n                            }\r\n                            `}\r\n            </style>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default AddPhoto\r\n"]},"metadata":{},"sourceType":"module"}